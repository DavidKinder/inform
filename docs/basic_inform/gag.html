<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Glulx and Glk</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script src="http://code.jquery.com/jquery-1.12.4.min.js"
	integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="../docs-assets/Bigfoot.js"></script>
<link href="../docs-assets/Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html"><img src="../docs-assets/Inform.png" height=72> </a></h1>
<ul><li><a href="../index.html">home</a></li>
</ul><h2>Compiler</h2><ul>
<li><a href="../structure.html">structure</a></li>
<li><a href="../inbuildn.html">inbuild</a></li>
<li><a href="../inform7n.html">inform7</a></li>
<li><a href="../intern.html">inter</a></li>
<li><a href="../services.html">services</a></li>
<li><a href="../secrets.html">secrets</a></li>
</ul><h2>Other Tools</h2><ul>
<li><a href="../inblorbn.html">inblorb</a></li>
<li><a href="../inform6.html">inform6</a></li>
<li><a href="../inpolicyn.html">inpolicy</a></li>
</ul><h2>Resources</h2><ul>
<li><a href="../extensions.html">extensions</a></li>
<li><a href="../kits.html">kits</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inform"><img src="../docs-assets/github.png" height=0> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=0> inweb</a></li>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=0> intest</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Glulx and Glk' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../extensions.html">Extensions</a></li><li><a href="index.html">Basic Inform</a></li><li><b>Glulx and Glk</b></li></ul></div>
<p class="purpose">Support for Glulx and Glk interpreter systems.</p>

<ul class="toc"><li><a href="gag.html#SP2">&#167;2. Version numbering</a></li><li><a href="gag.html#SP3">&#167;3. Feature testing</a></li><li><a href="gag.html#SP4">&#167;4. Glk windows</a></li><li><a href="gag.html#SP7">&#167;7. Basic window functions</a></li><li><a href="gag.html#SP8">&#167;8. Glk events</a></li><li><a href="gag.html#SP10">&#167;10. Suspending input</a></li><li><a href="gag.html#SP11">&#167;11. Glk object recovery</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. </b> </p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Part Four - Glulx and Glk (for Glulx only)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Version numbering.</b> </p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Version numbers</span>

<span class="plain-syntax">To decide which number is the major version of (V - version number):</span>
<span class="plain-syntax">    (- (VERSION_NUMBER_TY_Extract({V}, 0)) -).</span>
<span class="plain-syntax">To decide which number is the minor version of (V - version number):</span>
<span class="plain-syntax">    (- (VERSION_NUMBER_TY_Extract({V}, 1)) -).</span>
<span class="plain-syntax">To decide which number is the patch version of (V - version number):</span>
<span class="plain-syntax">    (- (VERSION_NUMBER_TY_Extract({V}, 2)) -).</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Feature testing.</b>  These phrases let us test for various interpreter features.
While most features can use the generic functions, a few need special handling,
and so individual phrases are defined for them.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Glk and Glulx feature testing</span>

<span class="plain-syntax">Definition: a glk feature is supported rather than unsupported if I6 routine</span>
<span class="plain-syntax">    "GlkFeatureTest" says so (it is supported by the interpreter).</span>

<span class="plain-syntax">To decide what version number is the glk version number/--</span>
<span class="plain-syntax">    (documented at ph_glkversion):</span>
<span class="plain-syntax">    (- VERSION_NUMBER_TY_NewFromPacked(Cached_Glk_Gestalts--&gt;gestalt_Version) -).</span>

<span class="plain-syntax">Definition: a glulx feature is supported rather than unsupported if I6 routine</span>
<span class="plain-syntax">    "GlulxFeatureTest" says so (it is supported by the interpreter).</span>

<span class="plain-syntax">To decide what version number is the glulx version number/--:</span>
<span class="plain-syntax">    (- VERSION_NUMBER_TY_NewFromPacked(Cached_Glulx_Gestalts--&gt;GLULX_GESTALT_GlulxVersion) -).</span>

<span class="plain-syntax">To decide what version number is the interpreter version number/--:</span>
<span class="plain-syntax">    (- VERSION_NUMBER_TY_NewFromPacked(Cached_Glulx_Gestalts--&gt;GLULX_GESTALT_TerpVersion) -).</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. Glk windows.</b>  Minimal support for Glk windows. Other extensions may extend the kind.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Glk windows</span>

<span class="plain-syntax">A Glk window is a kind of abstract object.</span>
<span class="plain-syntax">The glk window kind is accessible to Inter as "K_Glk_Window".</span>
<span class="plain-syntax">The specification of a glk window is "Models the Glk window system."</span>

<span class="plain-syntax">A glk window has a glk window type called the window type.</span>
<span class="plain-syntax">The window type property translates into Inter as "glk_window_type".</span>

<span class="plain-syntax">A glk window has a number called the rock number.</span>
<span class="plain-syntax">The rock number property translates into Inter as "glk_rock".</span>

<span class="plain-syntax">A glk window has a number called the glk window handle.</span>
<span class="plain-syntax">The glk window handle property translates into Inter as "glk_ref".</span>

<span class="plain-syntax">Definition: a glk window is on-screen rather than off-screen if the glk window handle of it is not 0.</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. </b>  Setting window types is quite verbose, so we have some subkinds to make it easier.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">A graphics window is a kind of glk window.</span>
<span class="plain-syntax">The window type of a graphics window is graphics window type.</span>
<span class="plain-syntax">A text buffer window is a kind of glk window.</span>
<span class="plain-syntax">The window type of a text buffer window is text buffer window type.</span>
<span class="plain-syntax">A text grid window is a kind of glk window.</span>
<span class="plain-syntax">The window type of a text grid window is text grid window type.</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. </b>  Create objects for each of the built in windows.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">The main window is a text buffer window.</span>
<span class="plain-syntax">The main window object is accessible to Inter as "Main_Window".</span>

<span class="plain-syntax">The status window is a text grid window.</span>
<span class="plain-syntax">The status window object is accessible to Inter as "Status_Window".</span>

<span class="plain-syntax">The quote window is a text buffer window.</span>
<span class="plain-syntax">The quote window object is accessible to Inter as "Quote_Window".</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Basic window functions.</b>  Some basic Glk window functions will be supported out of the box, but others will
require extensions.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Section - Glk windows</span>

<span class="plain-syntax">To clear (win - a glk window)</span>
<span class="plain-syntax">    (documented at ph_glkwindowclear):</span>
<span class="plain-syntax">    (- WindowClear({win}); -).</span>

<span class="plain-syntax">To focus (win - a glk window)</span>
<span class="plain-syntax">    (documented at ph_glkwindowfocus):</span>
<span class="plain-syntax">    (- WindowFocus({win}); -).</span>

<span class="plain-syntax">To decide what number is the height of (win - a glk window)</span>
<span class="plain-syntax">    (documented at ph_glkwindowheight):</span>
<span class="plain-syntax">    (- WindowGetSize({win}, 1) -).</span>

<span class="plain-syntax">To decide what number is the width of (win - a glk window)</span>
<span class="plain-syntax">    (documented at ph_glkwindowwidth):</span>
<span class="plain-syntax">    (- WindowGetSize({win}, 0) -).</span>

<span class="plain-syntax">To set (win - a glk window) cursor to row (row - a number) and/-- column/col (col - a number)</span>
<span class="plain-syntax">    (documented at ph_glksetcursor):</span>
<span class="plain-syntax">    (- WindowMoveCursor({win}, {col}, {row}); -).</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Glk events.</b>  Glk events can be handled with the glk event handling rules.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Glk events</span>

<span class="plain-syntax">To decide what glk event is (evtype - glk event type) glk event:</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, {evtype}) -).</span>

<span class="plain-syntax">To decide what glk event is a/-- character event with (C - unicode character):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_CharInput, 0, MapUnicodeToGlkKeyCode({C})) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- character event with (C - unicode character) in (win - glk window)</span>
<span class="plain-syntax">    (documented at ph_glkcharacterevent):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_CharInput, {win}, MapUnicodeToGlkKeyCode({C})) -).</span>

<span class="plain-syntax">To decide what glk event is a/-- line event with (T - text):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_LineInput, 0, 0, 0, {-by-reference:T}) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- line event with (T - text) in (win - glk window)</span>
<span class="plain-syntax">    (documented at ph_glklineevent):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_LineInput, {win}, 0, 0, {-by-reference:T}) -).</span>

<span class="plain-syntax">To decide what glk event is a/-- mouse event for/of/with x (x - number) and/-- y (y - a number) coordinates/--:</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_MouseInput, 0, {x}, {y}) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- mouse event for/of/with x (x - number) and/-- y (y - a number) coordinates/-- in (win - glk window):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_MouseInput, {win}, {x}, {y}) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- mouse event for/of/with row (y - number) and/-- column/col (x - a number):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_MouseInput, 0, {x}, {y}) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- mouse event for/of/with row (y - number) and/-- column/col (x - a number) in (win - glk window):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_MouseInput, {win}, {x}, {y}) -).</span>

<span class="plain-syntax">To decide what glk event is a/-- hyperlink event for/of/with (val - number):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_Hyperlink, 0, {val}) -).</span>
<span class="plain-syntax">To decide what glk event is a/-- hyperlink event for/of/with (val - number) in (win - glk window):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_New({-new: glk event}, evtype_Hyperlink, {win}, {val}) -).</span>

<span class="plain-syntax">To decide what glk event type is type of (ev - glk event)</span>
<span class="plain-syntax">    (documented at ph_glkeventtype):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Type({ev}) -).</span>

<span class="plain-syntax">To decide what glk window is window of (ev - glk event)</span>
<span class="plain-syntax">    (documented at ph_glkeventwindow):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Window({ev}) -).</span>

<span class="plain-syntax">To decide what unicode character is the character value of (ev - glk event)</span>
<span class="plain-syntax">    (documented at ph_glkeventcharactervalue):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value1({ev}, evtype_CharInput) -).</span>

<span class="plain-syntax">To decide what number is the x coordinate of (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value1({ev}, evtype_MouseInput) -).</span>
<span class="plain-syntax">To decide what number is the y coordinate of (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value2({ev}) -).</span>
<span class="plain-syntax">To decide what number is the row of (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value2({ev}) -).</span>
<span class="plain-syntax">To decide what number is the column/col of (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value1({ev}, evtype_MouseInput) -).</span>

<span class="plain-syntax">To decide what number is the hyperlink value of (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Value1({ev}, evtype_Hyperlink) -).</span>

<span class="plain-syntax">To decide what text is the text of (ev - glk event)</span>
<span class="plain-syntax">    (documented at ph_glkeventtextvalue):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Text({ev}, {-new: text}) -).</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. </b>  And now the glk event handling rules themselves.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">The glk event handling rules is a glk event type based rulebook.</span>
<span class="plain-syntax">The glk event handling rules is accessible to Inter as "GLK_EVENT_HANDLING_RB".</span>

<span class="plain-syntax">The glk event handling rulebook has a glk event called the event.</span>

<span class="plain-syntax">The current glk event initialiser is a glk event variable.</span>
<span class="plain-syntax">The current glk event initialiser variable is defined by Inter as "current_glk_event".</span>

<span class="plain-syntax">Very first glk event handling rule for a glk event type</span>
<span class="plain-syntax">    (this is the set glk event processing variables rule):</span>
<span class="plain-syntax">    now the event is the current glk event initialiser.</span>

<span class="plain-syntax">To handle (ev - glk event):</span>
<span class="plain-syntax">    (- GLK_EVENT_TY_Handle_Instead({ev}); rtrue; -).</span>

<span class="plain-syntax">Glk event handling rule for a screen resize event (this is the redraw the status line rule):</span>
<span class="plain-syntax">    redraw the status window;</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. Suspending input.</b>  These properties and phrases allow the author to suspend and resume input requests.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Suspending and resuming input</span>

<span class="plain-syntax">A glk window has a text input status.</span>
<span class="plain-syntax">The text input status property translates into Inter as "text_input_status".</span>
<span class="plain-syntax">A glk window can be requesting hyperlink input.</span>
<span class="plain-syntax">The requesting hyperlink input property translates into Inter as "requesting_hyperlink".</span>
<span class="plain-syntax">A glk window can be requesting mouse input.</span>
<span class="plain-syntax">The requesting mouse input property translates into Inter as "requesting_mouse".</span>

<span class="plain-syntax">To suspend text input in (win - a glk window), without input echoing:</span>
<span class="plain-syntax">    (- SuspendTextInput({win}, {phrase options}); -).</span>

<span class="plain-syntax">To resume text input in (win - a glk window):</span>
<span class="plain-syntax">    (- ResumeTextInput({win}); -).</span>

<span class="plain-syntax">To decide what text is the current line input of (w - glk window):</span>
<span class="plain-syntax">    (- WindowBufferCopyToText({w}, {-new:text}) -).</span>

<span class="plain-syntax">To set the current line input of (w - glk window) to (t - text):</span>
<span class="plain-syntax">    (- WindowBufferSet({w}, {-by-reference:t}); -).</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. Glk object recovery.</b>  These rules are a low level system for managing Glk references. When a Glulx
game restarts and restores, the current Glk IO state is not reset. All the old
windows, sound channels etc. will be kept as they were, even though the game file
might be expecting a different state. This extension allows Inform 7 game files
to ensure that the IO state is as it should be. It does this in three stages:</p>
<ul>
<li>
<p>The &quot;reset glk references rules&quot; is run. Rules should be added to reset all
Glk references as if none existed.</p>
</li>
<li>
<p>The &quot;identify glk windows rules&quot; etc. are run. These rulebooks will be run
once for each Glk IO object which currently exists. Objects can be identified
through the current glk object rock number and current glk object reference
number variables.</p>
</li>
<li>
<p>The &quot;glk object updating rules&quot; is run. Rules should be added to correct the
Glk IO state by, for example, closing windows which shouldn't exist, and opening
windows which should but currently do not.</p>
</li>
</ul>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">Chapter - Glk object recovery</span>

<span class="plain-syntax">The current glk object rock number is a number that varies.</span>
<span class="plain-syntax">The current glk object rock number variable translates into Inter as "current_glk_object_rock".</span>
<span class="plain-syntax">The current glk object reference number is a number that varies.</span>
<span class="plain-syntax">The current glk object reference number variable translates into Inter as "current_glk_object_reference".</span>

<span class="plain-syntax">The reset glk references rules is a rulebook.</span>
<span class="plain-syntax">The reset glk references rules is accessible to Inter as "RESET_GLK_REFERENCES_RB".</span>
<span class="plain-syntax">The identify glk windows rules is a rulebook.</span>
<span class="plain-syntax">The identify glk windows rules is accessible to Inter as "IDENTIFY_WINDOWS_RB".</span>
<span class="plain-syntax">The identify glk streams rules is a rulebook.</span>
<span class="plain-syntax">The identify glk streams rules is accessible to Inter as "IDENTIFY_STREAMS_RB".</span>
<span class="plain-syntax">The identify glk filerefs rules is a rulebook.</span>
<span class="plain-syntax">The identify glk filerefs rules is accessible to Inter as "IDENTIFY_FILEREFS_RB".</span>
<span class="plain-syntax">The identify glk sound channels rules is a rulebook.</span>
<span class="plain-syntax">The identify glk sound channels rules is accessible to Inter as "IDENTIFY_SCHANNELS_RB".</span>
<span class="plain-syntax">The glk object updating rules is a rulebook.</span>
<span class="plain-syntax">The glk object updating rules is accessible to Inter as "GLK_OBJECT_UPDATING_RB".</span>
</pre>
<div class="lsmarkdown">
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. </b>  And the standard rules, which may be replaced by extensions.</p>
</div>
<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">The reset glk references for built in objects rule is listed first in the reset glk references rules.</span>
<span class="plain-syntax">The reset glk references for built in objects rule translates into Inter as "RESET_GLK_REFERENCES_R".</span>

<span class="plain-syntax">The cache gestalts rule is listed in the reset glk references rules.</span>
<span class="plain-syntax">The cache gestalts rule translates into Inter as "CACHE_GESTALTS_R".</span>

<span class="plain-syntax">The identify built in windows rule is listed first in the identify glk windows rules.</span>
<span class="plain-syntax">The identify built in windows rule translates into Inter as "IDENTIFY_WINDOWS_R".</span>

<span class="plain-syntax">The identify built in streams rule is listed first in the identify glk streams rules.</span>
<span class="plain-syntax">The identify built in streams rule translates into Inter as "IDENTIFY_STREAMS_R".</span>

<span class="plain-syntax">The identify built in filerefs rule is listed first in the identify glk filerefs rules.</span>
<span class="plain-syntax">The identify built in filerefs rule translates into Inter as "IDENTIFY_FILEREFS_R".</span>

<span class="plain-syntax">The identify built in sound channels rule is listed first in the identify glk sound channels rules.</span>
<span class="plain-syntax">The identify built in sound channels rule translates into Inter as "IDENTIFY_SCHANNELS_R".</span>

<span class="plain-syntax">The stop built in sound channels rule is listed in the glk object updating rules.</span>
<span class="plain-syntax">The stop built in sound channels rule translates into Inter as "STOP_SCHANNELS_R".</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="phdf.html">&#10094;</a></li><li class="progresssection"><a href="prmbl.html">prmbl</a></li><li class="progresssection"><a href="msdf.html">msdf</a></li><li class="progresssection"><a href="phdf.html">phdf</a></li><li class="progresscurrent">gag</li><li class="progresssection"><a href="addf.html">addf</a></li><li class="progressnext"><a href="addf.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

